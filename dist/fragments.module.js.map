{"version":3,"file":"fragments.module.js","sources":["../src/program.ts","../src/fragment.ts","../src/renderer.ts"],"sourcesContent":["export const createShader = (\n  gl: WebGLRenderingContext,\n  str: string,\n  type: number\n) => {\n  const shader = gl.createShader(type)\n  gl.shaderSource(shader, str)\n  gl.compileShader(shader)\n\n  const compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS)\n\n  if (!compiled) {\n    const error = gl.getShaderInfoLog(shader)\n    console.error(\"Error compiling shader\", shader, error)\n    gl.deleteShader(shader)\n\n    return null\n  }\n\n  return shader\n}\n\nexport const createProgram = (\n  gl: WebGLRenderingContext,\n  vertexShader: string,\n  fragmentShader: string\n) => {\n  const vs = createShader(gl, vertexShader, gl.VERTEX_SHADER)\n  const fs = createShader(gl, fragmentShader, gl.FRAGMENT_SHADER)\n\n  const program = gl.createProgram()\n  gl.attachShader(program, vs)\n  gl.attachShader(program, fs)\n  gl.linkProgram(program)\n\n  return program\n}\n","import { createProgram } from \"./program\"\nimport { vertexShader, fragmentShader } from \"./shaders\"\n\nexport class Fragment {\n  program: WebGLProgram\n  uniforms: object\n  attributes: object\n\n  constructor(gl: WebGLRenderingContext, fragment?: string) {\n    this.attributes = {}\n    this.uniforms = {}\n\n    this.program = createProgram(gl, vertexShader, fragmentShader)\n  }\n\n  getAttribute(gl: WebGLRenderingContext, name: string) {\n    if (!this.attributes[name]) {\n      this.attributes[name] = gl.getAttribLocation(this.program, name)\n    }\n\n    return this.attributes[name]\n  }\n\n  getUniform(gl: WebGLRenderingContext, name: string) {\n    if (!this.uniforms[name]) {\n      this.uniforms[name] = gl.getUniformLocation(this.program, name)\n    }\n\n    return this.uniforms[name]\n  }\n\n  setU1f(gl: WebGLRenderingContext, name: string, x: number) {\n    gl.uniform1f(this.getUniform(gl, name), x)\n  }\n\n  setU2f(gl: WebGLRenderingContext, name: string, x: number, y: number) {\n    gl.uniform2f(this.getUniform(gl, name), x, y)\n  }\n\n  setU2fv(gl: WebGLRenderingContext, name: string, v2: any) {\n    gl.uniform2fv(this.getUniform(gl, name), v2)\n  }\n\n  setU1i(gl: WebGLRenderingContext, name: string, x: number) {\n    gl.uniform1i(this.getUniform(gl, name), x)\n  }\n}\n","import { Fragment } from \"./fragment\"\n\nexport class Renderer {\n  width: number\n  height: number\n  fragments: Fragment[]\n  mouse: Float32Array\n  ready: boolean\n  pause: boolean\n  gl: WebGLRenderingContext\n  now: number\n\n  constructor() {\n    this.width = 320\n    this.height = 240\n\n    this.fragments = []\n\n    this.mouse = new Float32Array(2)\n\n    this.ready = false\n    this.pause = false\n    this.now = Date.now()\n\n    if (window.WebGLRenderingContext) {\n      this.init()\n    } else {\n      console.error(\"Your browser doesn't support WebGL\")\n    }\n  }\n\n  private onBlur = () => {\n    this.pause = true\n  }\n\n  private onFocus = () => {\n    this.pause = false\n  }\n\n  private onMove = (e: MouseEvent) => {\n    this.mouse[0] = e.clientX\n    this.mouse[1] = e.clientY\n  }\n\n  private useFragment(fragment: Fragment) {\n    this.gl.useProgram(fragment.program)\n\n    this.gl.enableVertexAttribArray(fragment.getAttribute(this.gl, \"position\"))\n    this.gl.vertexAttribPointer(\n      fragment.getAttribute(this.gl, \"position\"),\n      2,\n      this.gl.FLOAT,\n      false,\n      0,\n      0\n    )\n\n    fragment.setU2f(this.gl, \"uResolution\", this.width, this.height)\n    fragment.setU1f(this.gl, \"uTime\", (Date.now() - this.now) / 1000)\n    fragment.setU2fv(this.gl, \"uMouse\", this.mouse)\n  }\n\n  private init() {\n    const canvas = document.createElement(\"canvas\")\n    canvas.width = this.width\n    canvas.height = this.height\n    document.body.appendChild(canvas)\n\n    window.addEventListener(\"blur\", this.onBlur)\n    window.addEventListener(\"focus\", this.onFocus)\n    window.addEventListener(\"mousemove\", this.onMove)\n\n    this.gl = canvas.getContext(\"webgl\")\n\n    this.gl.getExtension(\"OES_texture_float\")\n    this.gl.getExtension(\"OES_standard_derivatives\")\n    this.gl.getExtension(\"OES_float_linear\")\n    this.gl.getExtension(\"OES_half_float_linear\")\n\n    if (!this.gl) {\n      console.error(\"Couldn't start WebGL. Try get.webgl.org/troubleshooting\")\n    }\n\n    // quad\n    const quad = new Float32Array([-1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0]); // prettier-ignore\n    const buffer = this.gl.createBuffer()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, quad, this.gl.STATIC_DRAW)\n  }\n\n  public setSize(width: number, height: number) {\n    this.width = width\n    this.height = height\n\n    this.gl.canvas.width = this.width\n    this.gl.canvas.height = this.height\n\n    this.gl.viewport(0, 0, this.width, this.height)\n  }\n\n  // loads external fragment file.frag\n  public loadFragment(url: string) {\n    fetch(url)\n      .then((e) => e.text())\n      .then((raw) => this.raw(raw))\n  }\n\n  // adds a raw fragment to the renderer\n  public raw(fragment: string) {\n    this.ready = false\n    this.fragments.push(new Fragment(this.gl, fragment))\n    this.ready = true\n  }\n\n  public clear(r: number = 0, g: number = 0, b: number = 0, a: number = 1) {\n    this.gl.clearColor(r, g, b, a)\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT)\n  }\n\n  public render() {\n    if (this.ready !== true) return\n    if (this.pause) return\n\n    this.clear()\n\n    for (let i = 0; i < this.fragments.length; i++) {\n      this.useFragment(this.fragments[i])\n      this.gl.drawArrays(this.gl.TRIANGLES, 0, 6)\n    }\n  }\n}\n"],"names":["createShader","gl","str","type","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","error","getShaderInfoLog","console","deleteShader","Fragment","fragment","this","attributes","uniforms","program","vertexShader","fragmentShader","vs","VERTEX_SHADER","fs","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getAttribute","name","getAttribLocation","getUniform","getUniformLocation","setU1f","x","uniform1f","setU2f","y","uniform2f","setU2fv","v2","uniform2fv","setU1i","uniform1i","Renderer","_this","pause","e","mouse","clientX","clientY","width","height","fragments","Float32Array","ready","now","Date","window","WebGLRenderingContext","init","useFragment","useProgram","enableVertexAttribArray","vertexAttribPointer","FLOAT","canvas","document","createElement","body","appendChild","addEventListener","onBlur","onFocus","onMove","getContext","getExtension","quad","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","setSize","viewport","loadFragment","url","fetch","then","text","raw","_this2","push","clear","r","g","b","a","clearColor","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","render","i","length","drawArrays","TRIANGLES"],"mappings":"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"}