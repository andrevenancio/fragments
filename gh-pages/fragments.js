var t=function(t,e,i){var r=t.createShader(i);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var s=t.getShaderInfoLog(r);return console.error("Error compiling shader",r,s),t.deleteShader(r),null}return r},e=function(){function e(e,i){this.attributes={},this.uniforms={},this.program=function(e,i,r){var s=t(e,"\nattribute vec2 position;\nvoid main() {\n    gl_Position = vec4(position, 0.0, 1.0);\n}",e.VERTEX_SHADER),n=t(e,r,e.FRAGMENT_SHADER),h=e.createProgram();return e.attachShader(h,s),e.attachShader(h,n),e.linkProgram(h),h}(e,0,i)}var i=e.prototype;return i.getAttribute=function(t,e){return this.attributes[e]||(this.attributes[e]=t.getAttribLocation(this.program,e)),this.attributes[e]},i.getUniform=function(t,e){return this.uniforms[e]||(this.uniforms[e]=t.getUniformLocation(this.program,e)),this.uniforms[e]},i.setU1f=function(t,e,i){t.uniform1f(this.getUniform(t,e),i)},i.setU2f=function(t,e,i,r){t.uniform2f(this.getUniform(t,e),i,r)},i.setU2fv=function(t,e,i){t.uniform2fv(this.getUniform(t,e),i)},i.setU1i=function(t,e,i){t.uniform1i(this.getUniform(t,e),i)},e}(),i=function(){function t(t,e,i,r){this.width=1,this.height=1,this.level=r,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture);var s=t.RGBA,n=t.RGBA,h=t.UNSIGNED_BYTE,o=new Uint8Array([0,255,255,255]);t.texImage2D(t.TEXTURE_2D,this.level,s,this.width,this.height,0,n,h,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,this.level),t.bindFramebuffer(t.FRAMEBUFFER,null)}return t.prototype.setSize=function(t,e,i){this.width=e,this.height=i,t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},t}();exports.Renderer=function(){function t(t){var e=this;void 0===t&&(t={}),this.props={autoClear:!0,autoUpdate:!1},this.onBlur=function(){e.pause=!0},this.onFocus=function(){e.pause=!1},this.onMove=function(t){e.mouse[0]=t.clientX,e.mouse[1]=t.clientY},this.getNext=function(t){return(t+1)%2},Object.assign(this.props,t),this.width=320,this.height=240,this.mouse=new Float32Array(2),this.fragments=[],this.rendertargets=[],this.currentrt=0,this.loaded=0,this.ready=!1,this.pause=!1,this.now=Date.now(),window.WebGLRenderingContext?this.init():console.error("Your browser doesn't support WebGL")}var r=t.prototype;return r.useFragment=function(t){this.gl.useProgram(t.program),this.gl.enableVertexAttribArray(t.getAttribute(this.gl,"position")),this.gl.vertexAttribPointer(t.getAttribute(this.gl,"position"),2,this.gl.FLOAT,!1,0,0),t.setU2f(this.gl,"iResolution",this.width,this.height),t.setU1f(this.gl,"iTime",(Date.now()-this.now)/1e3),t.setU2fv(this.gl,"iMouse",this.mouse)},r.init=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.style.display="block",document.body.appendChild(t),window.addEventListener("mousemove",this.onMove),this.gl=t.getContext("webgl"),this.gl.getExtension("OES_texture_float"),this.gl.getExtension("OES_standard_derivatives"),this.gl.getExtension("OES_float_linear"),this.gl.getExtension("OES_half_float_linear"),this.gl||console.error("Couldn't start WebGL. Try get.webgl.org/troubleshooting"),console.log.apply(console,["\n%cfragments%crenderer%c (dev)\n","background: #00ffff; color: #1A1A1A; font-size: x-small;","background: #1A1A1A; color: #00ffff; font-size: x-small;","background: transparent; color: #999999; font-size: x-small;"]),this.originalImageTexture=new i(this.gl,512,512,0);var e=new i(this.gl,512,512,1),r=new i(this.gl,512,512,2);this.rendertargets=[e,r];var s=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.quadbuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quadbuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW)},r.setSize=function(t,e){var i=this;this.width=t,this.height=e,this.gl.canvas.width=this.width,this.gl.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.originalImageTexture.setSize(this.gl,this.width,this.height),this.rendertargets.forEach(function(t){t.setSize(i.gl,i.width,i.height)})},r.loadFragment=function(t){var e=this;this.ready=!1;var i=this.fragments.length;this.fragments.push(null),fetch(t).then(function(t){return t.text()}).then(function(t){return e.raw(t,i)})},r.raw=function(t,i){this.ready=!1;var r=new e(this.gl,t);"number"==typeof i?this.fragments[i]=r:this.fragments.push(r),this.loaded++,this.fragments.length===this.loaded&&(this.ready=!0)},r.clear=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this.gl.clearColor(t,e,i,r),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},r.render=function(){if(!0===this.ready&&!this.pause){this.props.autoClear&&this.clear(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.originalImageTexture.texture);for(var t=0;t<this.fragments.length;++t)console.log("draw fragment",t,"to render target",t%2),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.rendertargets[t%2].fbo),this.useFragment(this.fragments[t]),this.gl.viewport(0,0,this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rendertargets[t%2].texture);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.useFragment(this.fragments[this.fragments.length-1]),this.gl.viewport(0,0,this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}},t}();
//# sourceMappingURL=fragments.js.map
